<p>Author: <a href="https://github.com/kumapana/">panakuma</a></p>
<h2 id="linux-kernal-413がやっと動いたが">Linux Kernal 4.13がやっと動いたが…</h2>
<p>私のマシンでは長らくLinux kernel 4.4系しか動かなかったのですが、Oracle VirtualBoxの関連コンポーネントを根こそぎ削除したところ4.13系が動作しました。ですが…</p>

<p><strong>VMware Workstation Pro 14上の仮想マシンが起動しなくなりました</strong></p>

<p>具体的には次のようなエラーメッセージが表示されます。</p>

<p><img src="/images/vmware/img01.png" alt="unable to reserve memory" /></p>

<p><img src="/images/vmware/img02.png" alt="could not lock memory" /></p>

<p><img src="/images/vmware/img03.png" alt="failed to switch to 64bit mode" /></p>

<p>VMware Workstation がkernel4.13に対応していないことが原因のようです。Kernelに対する命令である<code class="highlighter-rouge">global_page_state</code>が4.13以降で<code class="highlighter-rouge">global_zone_page_state</code>に変わったことが原因です。有志の方がこれに対応するパッチを作成していたので、これを用いて対処していきます。</p>

<p>次のコマンドでパッチを当てることができます。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    sudo -i
    cd /tmp
    cp /usr/lib/vmware/modules/source/vmmon.tar .
    tar xf vmmon.tar
    rm vmmon.tar
    wget https://raw.githubusercontent.com/mkubecek/vmware-host-modules/fadedd9c8a4dd23f74da2b448572df95666dfe12/vmmon-only/linux/hostif.c
    mv -f hostif.c vmmon-only/linux/hostif.c 
    tar cf vmmon.tar vmmon-only
    rm -fr vmmon-only
    mv -f vmmon.tar /usr/lib/vmware/modules/source/vmmon.tar 
    vmware-modconfig --console --install-all
</code></pre>
</div>

<p>コマンド実行後に再起動を行うことで、VMware Workstationが正常に動作します。</p>

<hr />
<p>参考文献</p>

<p><a href="https://bbs.archlinux.org/viewtopic.php?id=230487">Arch Linux User Forums VMWare Workstation 14.0 - not enough physical memory</a></p>
