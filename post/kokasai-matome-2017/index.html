<!DOCTYPE html>
<html class="no-js">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>紅華祭 2017を終えて</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="LinuxClubが紅華祭で展示した内容を紹介していきます。" />

<meta name="keywords" content="kokasai, festival, 2017, ">


<meta property="og:title" content="紅華祭 2017を終えて  &middot; LinuxClub BLOG ">
<meta property="og:site_name" content="LinuxClub BLOG"/>
<meta property="og:url" content="https://lc-tut.github.io/post/kokasai-matome-2017/" />
<meta property="og:locale" content="ja-jp">


<meta property="og:type" content="article" />
<meta property="og:description" content="LinuxClubが紅華祭で展示した内容を紹介していきます。"/>
<meta property="og:article:published_time" content="2017-10-20T00:00:00Z" />
<meta property="og:article:modified_time" content="2017-10-20T00:00:00Z" />

  
    
<meta property="og:article:tag" content="kokasai">
    
<meta property="og:article:tag" content="festival">
    
<meta property="og:article:tag" content="2017">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="紅華祭 2017を終えて" />
<meta name="twitter:description" content="LinuxClubが紅華祭で展示した内容を紹介していきます。" />
<meta name="twitter:url" content="https://lc-tut.github.io/post/kokasai-matome-2017/" />
<meta name="twitter:domain" content="https://lc-tut.github.io/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "紅華祭 2017を終えて",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2017-10-20",
    "description": "LinuxClubが紅華祭で展示した内容を紹介していきます。",
    "wordCount": 708
  }
</script>


<link rel="canonical" href="https://lc-tut.github.io/post/kokasai-matome-2017/" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://lc-tut.github.io/assets/css/style.css">
  <link rel="stylesheet" href="https://lc-tut.github.io/assets/css/tomorrow-night.css">

  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://lc-tut.github.io/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://lc-tut.github.io/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://lc-tut.github.io/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://lc-tut.github.io/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://lc-tut.github.io/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://lc-tut.github.io/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://lc-tut.github.io/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://lc-tut.github.io/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="https://lc-tut.github.io/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="https://lc-tut.github.io/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="https://lc-tut.github.io/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://lc-tut.github.io/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="https://lc-tut.github.io/favicon-128.png" sizes="128x128" />
<meta name="application-name" content="紅華祭 2017を終えて"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="/mstile-310x310.png" />

</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-md site-navbar bg-info">
    <a class="navbar-brand text-white" href="https://lc-tut.github.io/">LinuxClub BLOG</a>
  <button class="navbar-toggler" 
  type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2"
    aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-collapse" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav ml-auto">
       
      <li class="nav-item">
        <a class="nav-link menu-item  no-decoration text-white" href="https://lc-tut.github.io/tags/">
          <i class='fa fa-tags'></i>
          <span class="text-capitalize">TAGS</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link menu-item  no-decoration text-white" href="https://lc-tut.github.io/categories/">
          <i class='fa fa-folder-open'></i>
          <span class="text-capitalize">CATEGORIES</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link menu-item  no-decoration text-white" href="https://www2.linux.it.teu.ac.jp/linux/?from=blog">
          <i class='fa fa-info-circle'></i>
          <span class="text-capitalize">ABOUT US</span>
        </a>
      </li>
      
    </ul>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-sm-12">
    
      <div>
  <h1 class="post-title">紅華祭 2017を終えて
</h1>

  <div class="post-meta">
  <div class="post-meta-item">
    <time datetime="10 Oct 20106">20 Oct, 2017</time>
    &middot; 4 min read
    &middot; 708 Words
  </div>

  
      
      
      <div class="post-meta-item">
          <i class="fa fa-folder-open-o"></i>
          
          <a class="article-category-link" href="https://lc-tut.github.io/categories/poem/">poem</a>
          &middot;
          
          <a class="article-category-link" href="https://lc-tut.github.io/categories/activity/">activity</a>
          
          
      </div>
      
  

  
      
      
        <div class="post-meta-item">
          <i class="fa fa-tags"></i>
          
          <a href="https://lc-tut.github.io/tags/kokasai/">kokasai</a>
          &middot;
          
          <a href="https://lc-tut.github.io/tags/festival/">festival</a>
          &middot;
          
          <a href="https://lc-tut.github.io/tags/2017/">2017</a>
          
          
        </div>
      
  

</div>

  

</div>

      <div class="article-body">
  

<p>LinuxClubの1年のKoyamaです。</p>

<p>今後、このブログを通じてサークルの活動の様子を積極的に発信していきたいと思います。この記事では2017年度 紅華祭を振り返ってみたいと思います。まず、部長から全体を通したコメントです。</p>

<h2 id="全体を通じて">全体を通じて</h2>

<p>前日に完成している展示物がなくて焦ったものですがみなさんいいものを作ってきてくれて驚きました。普段コンソールに向かっているので見栄えのいいものと言われても困ったとは思いますが良い作品を展示できてよかったです。</p>

<h2 id="個人制作">個人制作</h2>

<p>1,2年生を中心に個人作品を制作しました。<code>作品名 [作者]</code>という形式で見出しをつけています。</p>

<h3 id="1-空飛ぶ絨毯-koyama">1. 空飛ぶ絨毯 [Koyama]</h3>

<p>Webカメラで取得した映像とあらかじめ用意した動画をクロマキー合成するプログラムを作成し、展示しました。使用した言語は<code>Python</code>でライブラリは<code>OpenCV</code>を使用しました。以下の記事を参考にしながらコードを書きました。</p>

<ul>
<li><a href="https://www.blog.umentu.work/python-opencv3%E3%81%A7%E7%94%BB%E5%83%8F%E3%81%AE%E7%94%BB%E7%B4%A0%E5%80%A4%E3%82%92%E4%BA%8C%E5%80%A4%E5%8C%96%E3%81%97%E3%81%A6%E5%87%BA%E5%8A%9B/">Python OpenCV3で画像の画素値を二値化して出力 | from umentu import stupid</a></li>
<li><a href="http://make.kosakalab.com/rpi/opencv_3/">RPi + Python + OpenCV その３「クロマキー」 | OpenCV | kosakalab</a></li>
<li><a href="http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_gui/py_video_display/py_video_display.html">Getting Started with Videos — OpenCV-Python Tutorials 1 documentation</a></li>
</ul>

<p>ソースコードは以下です。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python</span>

<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> cv2
<span style="color:#f92672">import</span> sys

argv <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv

<span style="color:#66d9ef">try</span>:
    <span style="color:#66d9ef">if</span> argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;1&#34;</span>:
        param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cloud.mp4&#34;</span>
    <span style="color:#66d9ef">elif</span> argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;2&#34;</span>:
        param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;coastline.mp4&#34;</span>
    <span style="color:#66d9ef">elif</span> argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;3&#34;</span>:
        param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;campus.mp4&#34;</span>
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">IndexError</span>:
    param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;campus.mp4&#34;</span>

<span style="color:#75715e"># Windows size Swttings</span>
winSize <span style="color:#f92672">=</span> ( <span style="color:#ae81ff">1300</span>, <span style="color:#ae81ff">700</span> )

<span style="color:#75715e"># Sets color-range of mask</span>
<span style="color:#75715e"># [memo] (Blue, Green, Red)</span>
lower <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">60</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">80</span>])     <span style="color:#75715e"># Min</span>
upper <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">250</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>])  <span style="color:#75715e"># Max</span>

<span style="color:#75715e"># Camera Settings</span>
videoStr <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoCapture(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Background Settings</span>
backVdo <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoCapture(<span style="color:#e6db74">&#39;videos/&#39;</span> <span style="color:#f92672">+</span> param)

<span style="color:#66d9ef">while</span>(True):
    <span style="color:#75715e"># Get each frame</span>
    ret, front <span style="color:#f92672">=</span> videoStr<span style="color:#f92672">.</span>read()
    ret, back  <span style="color:#f92672">=</span> backVdo<span style="color:#f92672">.</span>read()

    <span style="color:#75715e"># Resize movies</span>
    front <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(front, winSize)
    back <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(back, winSize)

    <span style="color:#75715e"># Convert BGR to HSR</span>
    hsvFront <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(front, cv2<span style="color:#f92672">.</span>COLOR_BGR2HSV)

    <span style="color:#75715e"># Make mask by &#39;hsvFront&#39;</span>
    maskFront <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>inRange(hsvFront, lower, upper)

    <span style="color:#75715e"># Apply Gaussian-blur</span>
    <span style="color:#75715e"># gMaskFront = cv2.GaussianBlur(maskFront, (5, 5), 0)</span>

    <span style="color:#75715e"># Revrse Mask area</span>
    <span style="color:#75715e"># rgMaskFront = cv2.bitwise_not(gMaskFront)</span>
    rgMaskFront <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>bitwise_not(maskFront)

    <span style="color:#75715e"># Attach mask</span>
    streamFront <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>bitwise_and(front, front, mask<span style="color:#f92672">=</span>rgMaskFront)
    streamBack <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>bitwise_and(back, back, mask<span style="color:#f92672">=</span>maskFront)

    <span style="color:#75715e"># Catinate each mask</span>
    disp <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>bitwise_or(streamFront, streamBack, maskFront)

    <span style="color:#75715e"># Display windows</span>
    cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;DEMO:disp&#39;</span>,disp)
    <span style="color:#75715e"># cv2.imshow(&#39;DEMO:front&#39;,front)</span>
    <span style="color:#75715e"># cv2.imshow(&#39;DEMO:back&#39;,back)</span>

    <span style="color:#75715e"># Delay 10ms and Check keydown &#39;q&#39; for exit</span>
    <span style="color:#66d9ef">if</span> cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span> <span style="color:#f92672">==</span> ord(<span style="color:#e6db74">&#39;q&#39;</span>):
        <span style="color:#66d9ef">break</span>

<span style="color:#75715e"># Release objects</span>
videoStr<span style="color:#f92672">.</span>release()
backVdo<span style="color:#f92672">.</span>release()
cv2<span style="color:#f92672">.</span>destroyAllWindows()</code></pre></div>
<p>途中でOpenCVのエラーで終了してしまうのでシェル芸で回避しました。パラメータを変えることで背景の動画を変更できる機能も実装してうまく連携させました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#66d9ef">while</span> true
<span style="color:#66d9ef">do</span>
  <span style="color:#66d9ef">for</span> foo in <span style="color:#f92672">{</span><span style="color:#ae81ff">1</span>..3<span style="color:#f92672">}</span>
  <span style="color:#66d9ef">do</span>
    python3 origin.py $foo
  <span style="color:#66d9ef">done</span>
<span style="color:#66d9ef">done</span></code></pre></div>
<p>実際に動かすと以下のようになります。</p>

<p><img src="https://lc-tut.github.io/post_media/kokasai2017/koyama_screenshot.jpg"></p>

<h3 id="2-移植版ドアセンサー-koyama">2. 移植版ドアセンサー [Koyama]</h3>

<p>サークルの部室にドアが開くと音が鳴る謎のシステム(Raspi + スピーカ)を作りました。その移植版をArduino UNOとProcessingを使って作成しました。センサーは秋月電子で販売されているドア用センサーを使いました。</p>

<p><a href="http://akizukidenshi.com/catalog/g/gP-04025/">ケース入りリードスイッチ（磁石付セット）ＭＣ－１４ＡＧ: センサ一般 秋月電子通商 電子部品 ネット通販</a></p>

<p>Arduinoには次の回路を実装しました。</p>

<p><img src="https://raw.githubusercontent.com/tomoyk/kokasai17/master/proc_testVisualizer/images/architecture.jpg"></p>

<p>次にArduinoへ以下のプログラムを書き込みます。このプログラムではdigital 7番ピンに接続されたセンサーの値を取得してシリアルに書き出す処理を行っています。<code>delay(100)</code>によって遅延処理を行っています。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#define SENSOR_PIN 7
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>(){
  Serial.begin(<span style="color:#ae81ff">9600</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>(){
  <span style="color:#66d9ef">int</span> val <span style="color:#f92672">=</span> digitalRead(SENSOR_PIN);
  Serial.write(val);
  delay(<span style="color:#ae81ff">100</span>);
}</code></pre></div>
<p>Arduinoにプログラムが書き込めているかシリアルモニタを使って確認します。</p>

<p>次にProcessingを起動します。そして、以下のプログラムを入力します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> processing.sound.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> processing.serial.*<span style="color:#f92672">;</span>

<span style="color:#75715e">/* Viewer */</span>
<span style="color:#66d9ef">boolean</span> status <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> <span style="color:#75715e">// Now status
</span><span style="color:#75715e"></span><span style="color:#66d9ef">boolean</span> before <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span> <span style="color:#75715e">// Before status
</span><span style="color:#75715e"></span>PImage closeImg<span style="color:#f92672">,</span> openImg<span style="color:#f92672">;</span>
SoundFile hi<span style="color:#f92672">,</span> bye<span style="color:#f92672">;</span>

<span style="color:#75715e">/* Srial */</span>
Serial port<span style="color:#f92672">;</span>
<span style="color:#66d9ef">float</span> val<span style="color:#f92672">;</span>

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">settings</span><span style="color:#f92672">(){</span>
  size<span style="color:#f92672">(</span>1300<span style="color:#f92672">,</span> 700<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span><span style="color:#f92672">(){</span>
  <span style="color:#75715e">/* Serial */</span>
  frameRate<span style="color:#f92672">(</span>60<span style="color:#f92672">);</span>
  String arduinoPort <span style="color:#f92672">=</span> Serial<span style="color:#f92672">.</span><span style="color:#a6e22e">list</span><span style="color:#f92672">()[</span>0<span style="color:#f92672">];</span>
  port <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Serial<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> arduinoPort<span style="color:#f92672">,</span>9600<span style="color:#f92672">);</span>
  
  <span style="color:#75715e">/* Image and Sounds */</span>
  noStroke<span style="color:#f92672">();</span>
  setBack<span style="color:#f92672">();</span>
  closeImg <span style="color:#f92672">=</span> loadImage<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;proc_testVisualizer/door_close.png&#34;</span><span style="color:#f92672">);</span>
  openImg <span style="color:#f92672">=</span> loadImage<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;proc_testVisualizer/door_open.png&#34;</span><span style="color:#f92672">);</span>
  hi <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SoundFile<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;proc_testVisualizer/door_hello.wav&#34;</span><span style="color:#f92672">);</span>
  bye <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SoundFile<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;proc_testVisualizer/door_close.wav&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBack</span><span style="color:#f92672">(){</span>
  background<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">#</span>cccccc<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">draw</span><span style="color:#f92672">(){</span>
  <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>port<span style="color:#f92672">.</span><span style="color:#a6e22e">available</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">){</span>
    val <span style="color:#f92672">=</span> port<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">();</span>
    println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;test: &#34;</span><span style="color:#f92672">+</span>val<span style="color:#f92672">);</span>
    
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span> val <span style="color:#f92672">==</span> 1<span style="color:#f92672">.</span><span style="color:#a6e22e">0</span> <span style="color:#f92672">){</span>
      status <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
      status <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>status <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>before<span style="color:#f92672">){</span> <span style="color:#75715e">// open
</span><span style="color:#75715e"></span>      before<span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
      setBack<span style="color:#f92672">();</span>
      image<span style="color:#f92672">(</span>closeImg<span style="color:#f92672">,</span> 200<span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
      bye<span style="color:#f92672">.</span><span style="color:#a6e22e">play</span><span style="color:#f92672">();</span>      
    <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>status <span style="color:#f92672">&amp;&amp;</span> before<span style="color:#f92672">){</span> <span style="color:#75715e">// close
</span><span style="color:#75715e"></span>      before<span style="color:#f92672">=</span><span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
      setBack<span style="color:#f92672">();</span>
      image<span style="color:#f92672">(</span>openImg<span style="color:#f92672">,</span> 200<span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
      hi<span style="color:#f92672">.</span><span style="color:#a6e22e">play</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    
  <span style="color:#f92672">}</span>
  
  stroke<span style="color:#f92672">(</span>120<span style="color:#f92672">);</span>
  fill<span style="color:#f92672">(</span>255<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>プログラムの概要について説明します。</p>

<ul>
<li>プログラム先頭の<code>import processing.sound.*;</code>ではあらかじめインストールしたサウンドを再生するライブラリを読み込んでいます。</li>
<li>その後にある<code>boolean</code>や<code>PImage</code>や<code>Soundfile</code>ではセンサーの状態、画像ファイル、音声ファイルを保持する変数を宣言しています。</li>
<li><code>setup()</code>ではシリアル、画像、音声の初期化を行っています。</li>
<li><code>setBack()</code>では背景を設定しています。</li>
<li><code>draw()</code>ではセンサーの値に応じてドアが開いているか、閉じているかを判断しています。また、その状況に応じて画像や音声を切り替えています。</li>
</ul>

<p>次に画像ファイルと音声ファイルを用意します。</p>

<p>画像はいらすとやから入手しました。</p>

<p><a href="http://www.irasutoya.com/2016/07/blog-post_832.html">いろいろな状態のドアのイラスト | かわいいフリー素材集 いらすとや</a></p>

<p>ダウンロードした画像ファイルのドアが揃うようにGIMPで調整しました。そして、ファイル名を<code>door_close.png</code>と<code>door_open.png</code>にリネームします。</p>

<p>音声は音声合成システム<strong>Open JTalk</strong>を使用して作成しました。今回は一時的な使用だった為、Dockerを使いました。</p>

<p><a href="https://hub.docker.com/r/yamamotofebc/open_jtalk/">yamamotofebc/open_jtalk - Docker Hub</a></p>

<p>まず、イメージを入手します。</p>

<p><code>docker pull yamamotofebc/open_jtalk</code></p>

<p>次にリファレンスに従って生成したい文字列を設定してコマンドを実行します。単純な読み上げにしか対応していないので<code>こんにちは</code>を<code>こんにちわ</code>として設定しています。</p>

<pre><code>echo &quot;こんにちわ&quot; | docker run -i --rm yamamotofebc/open_jtalk &gt; door_hello.wav
echo &quot;ばいばいきん&quot; | docker run -i --rm yamamotofebc/open_jtalk &gt; door_close.wav
</code></pre>

<p>これらの準備が終わったらProcessingのIDEに戻って実行ボタンを押下します。LinuxではIDEをroot権限で起動しないとシリアルデバイスにアクセスできないので注意が必要です。</p>

<p>うまく動作すればドアセンサーが離れたときに画面上にドアが開いている画像が表示され、「こんにちは」という音声が流れます。</p>

<p><img src="https://raw.githubusercontent.com/tomoyk/kokasai17/master/proc_testVisualizer/images/demoOpen.jpg">
<img src="https://raw.githubusercontent.com/tomoyk/kokasai17/master/proc_testVisualizer/images/demoClose.jpg"></p>

<h3 id="3-物体認識-部長">3. 物体認識 [部長]</h3>

<p>DarkNetを使った物体認識ソフトウェアを作りました。
基本的な構造としては<code>Docker</code>を使い、<code>フロントエンド</code>、<code>バックエンド</code>、<code>静的ファイルの配信サーバー</code>という形で構築し、AWS上で動作させていました。</p>

<p>※<code>DarkNet</code>とはC言語で書かれた機械学習ライブラリです。学習済みデータが公開されているので画像をぶん投げるだけで解析してくれる優れものです。</p>

<h4 id="フロントエンド">フロントエンド</h4>

<p>使用ライブラリ</p>

<pre><code>- React
- Recompose
- Material UI
</code></pre>

<p>フロントエンドではES6に<code>React</code>, <code>Recompose</code>を使いました。
来場者にアクセスさせて写真をアップロード、解析した写真を表示する機能しか必要なかったのですが無駄にモダンな構成になっています。特筆することはないです。</p>

<h4 id="バックエンド">バックエンド</h4>

<p>使用ライブラリ</p>

<pre><code>- PIL (画像処理)
- falcon (APIサーバー)
</code></pre>

<p>バックエンドはpythonで書きました。falconでルーティングしてDarkNetに投げるなどの役割を担っています。</p>

<p>PILはiphoneから投げられた画像に対して処理をしています。画像は主にEXIFと呼ばれる情報の格納部分があり、そこにOrientationという画像の向きを保持する情報があります。iphoneで撮影された画像はその部分が常にright-topという横向きの状態で保持されるらしく、PILを使って画像を縦向きに回転して保存する処理をしてます。</p>

<p>PILは</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">img <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>open(filename)
exif <span style="color:#f92672">=</span> img<span style="color:#f92672">.</span>_getexif()
orientation <span style="color:#f92672">=</span> exif<span style="color:#f92672">.</span>get(<span style="color:#ae81ff">0x112</span>, <span style="color:#ae81ff">1</span>)
img<span style="color:#f92672">.</span>save(original_filename)</code></pre></div>
<p>とかするとexifをスッととってこれて楽でよかったです。</p>

<h4 id="静的ファイルの配信サーバー">静的ファイルの配信サーバー</h4>

<p>nginxでDarkNetで書き出された画像を配信してるだけです。特筆事項なし。</p>

<h4 id="反省など">反省など</h4>

<p>色々ばたついてて作り始めるのが遅かったせいで大したものが作れなかったのが心残りです。それとDarkNetをDockerの上に載せていたせいでレスポンスがだいぶ悪くなってしまいました。workerも4つしか動かしておらずお世辞にも十分だったとは言えない感じです。来年はGTX TITANとか買って望みたいです。嘘です。</p>

<h3 id="4-opencvのチュートリアル-homirun">4. OpenCVのチュートリアル [homirun]</h3>

<p>Webカメラで撮影された動画をリアルタイムでカスケード分類器を用い顔認識させてみました。
顔を検出してその上に某氏の画像をオーバーレイしました。
PyConの日に作りました。</p>

<p>使用ライブラリ
- OpenCV
- numpy
- pyplot</p>

<p><img src="https://lc-tut.github.io/post_media/kokasai2017/homirun_screenshot.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> cv2
<span style="color:#f92672">import</span> numpy
<span style="color:#f92672">from</span> matplotlib <span style="color:#f92672">import</span> pyplot

face_cascade <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>CascadeClassifier(
    <span style="color:#e6db74">&#34;/usr/local/Cellar/opencv/3.3.0_3/share/OpenCV/haarcascades/haarcascade_frontalface_default.xml&#34;</span>)

cap <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>VideoCapture(<span style="color:#ae81ff">0</span>)
coverImg <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#39;faces.png&#39;</span>, cv2<span style="color:#f92672">.</span>IMREAD_UNCHANGED)

<span style="color:#66d9ef">while</span> True:
    ret, img <span style="color:#f92672">=</span> cap<span style="color:#f92672">.</span>read()
    gray <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(img, cv2<span style="color:#f92672">.</span>COLOR_BGR2GRAY)
    faces <span style="color:#f92672">=</span> face_cascade<span style="color:#f92672">.</span>detectMultiScale(gray, <span style="color:#ae81ff">1.3</span>, <span style="color:#ae81ff">5</span>)
    <span style="color:#75715e">#eyes = eyes_cascade.detectMultiScale(gray, 1.3, 5)</span>
    <span style="color:#66d9ef">for</span>(x,y,w,h) <span style="color:#f92672">in</span> faces:
        <span style="color:#75715e">#cv2.rectangle(img,(x,y),(x+w, y+h), (255, 0, 0), 2)</span>
        <span style="color:#75715e">#cv2.rectangle(img,(x,y),(x+w, y+h), (255, 0, 0), 2)</span>
        <span style="color:#66d9ef">if</span> h <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> w <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>:
            coverResize <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(coverImg, (h,w), interpolation <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>INTER_AREA)
            alpha <span style="color:#f92672">=</span> coverResize[:,:,<span style="color:#ae81ff">3</span>]
            alphaArray <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((w,h,<span style="color:#ae81ff">3</span>))
            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(alphaArray)):
                <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(alphaArray[<span style="color:#ae81ff">0</span>])):
                    alphaArray[i][j] <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones(<span style="color:#ae81ff">3</span>) <span style="color:#f92672">*</span> alpha[i][j]
            alphaArray <span style="color:#f92672">=</span> alphaArray <span style="color:#f92672">/</span> <span style="color:#ae81ff">255.0</span>
            coverResize <span style="color:#f92672">=</span> coverResize<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float64&#39;</span>)
            coverResize <span style="color:#f92672">=</span> coverResize[:,:,:<span style="color:#ae81ff">3</span>]
            img[y:(y<span style="color:#f92672">+</span>h), x:(x<span style="color:#f92672">+</span>w)] <span style="color:#f92672">=</span> img[y:(y<span style="color:#f92672">+</span>h), x:(x<span style="color:#f92672">+</span>w)] <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> alphaArray)
            img[y:(y<span style="color:#f92672">+</span>h), x:(x<span style="color:#f92672">+</span>w)] <span style="color:#f92672">=</span> img[y:(y<span style="color:#f92672">+</span>h), x:(x<span style="color:#f92672">+</span>w)] <span style="color:#f92672">+</span> coverResize <span style="color:#f92672">*</span> alphaArray
    cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#34;img&#34;</span>, img)
    <span style="color:#66d9ef">if</span> cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFF</span> <span style="color:#f92672">==</span> ord(<span style="color:#e6db74">&#39;q&#39;</span>):
        <span style="color:#66d9ef">break</span>
cap<span style="color:#f92672">.</span>release()
cv2<span style="color:#f92672">.</span>destroyAllWindows()</code></pre></div>
<h3 id="5-声でツイートできるプログラム-panakuma">5. 声でツイートできるプログラム [panakuma]</h3>

<p>　音声認識で録音した音声をテキストに起こして、ツイッターにポストするプログラムです。言語はPythonで、音声認識はGoogle Cloud APIを使いました。</p>

<p>ソースコードは以下です。</p>

<h4 id="全体の実行スクリプト">全体の実行スクリプト</h4>

<script src="https://gist.github.com/kumapana/1f492a0cd948896eb090b28ac14c32a1.js"></script>

<h4 id="google-apiを叩くソース">Google APIを叩くソース</h4>

<script src="https://gist.github.com/kumapana/1f492a0cd948896eb090b28ac14c32a1.js"></script>

<h4 id="ツイッターに投げるソース">ツイッターに投げるソース</h4>

<script src="https://gist.github.com/kumapana/be3eb1e828384f427d00349dfe387117.js"></script>

<h4 id="ハマった-点">ハマった(?)点</h4>

<p>Google Cloud APIから吐かれるjsonファイルの取り扱いで1日ほどハマってました。(最終的にK氏に解決していただいた)</p>

<p>当初の予定では、京都大学 河原研究室が開発したJuliusという音声認識システムを使う予定でしたが、認識精度が低かったため、Google APIに投げることにしました。</p>

<h3 id="6-cpu-use-rate-lapua">6. CPU use rate [lapua]</h3>

<p>CPU使用率をリアルタイムで表示するGUIアプリ。16コアまで対応。使用ライブラリはQt5.0.0
初めてのクラス設計に苦労しました。</p>

<p><img src="https://lc-tut.github.io/post_media/kokasai2017/lapua_screenshot.png"></p>

<h3 id="7-数当てゲーム-ayu">7. 数当てゲーム [ayu]</h3>

<p>コンソールから入力された数字に対して当ってるだの当ってないだの評価して返す簡単なゲーム．Javaで書きました．GUI化させていきたい．</p>

<p><img src="https://lc-tut.github.io/post_media/kokasai2017/ayu_screenshot.png"></p>

<h3 id="8-目覚まし-uwdd">8. 目覚まし [uwdd]</h3>

<p>今回初めて<del>まともな</del>プログラミング作品を作りました。朝起きれなくて遅刻が増えてきたので今回は目覚まし時計を作りました。まだいくつか不具合があったりデザインが簡素すぎたりするので暇があれば直していきたい。</p>

<p><img src="https://lc-tut.github.io/post_media/kokasai2017/uwdd_screenshot.png"></p>

<h2 id="毎年恒例-のlc-ob会">毎年恒例?のLC OB会</h2>

<p>LinuxClubの歴史は長いらしく、古くはLinux研究所という名前だったそうです。</p>

<p>学祭で社会人OBが集まるということが恒例になっているようです。OBと現役生の交流の場になっていました。</p>

<h2 id="2日目から始まったライブ中継">2日目から始まったライブ中継</h2>

<p>2日目から先輩のカメラでライブ中継を行いました。</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/KyDryF34rFQ?rel=0" frameborder="0" allowfullscreen></iframe>

<h2 id="大学からの取材">大学からの取材</h2>

<p>大学の広報から取材を受けました。何かしらの映像で公開されるかと思われます。おそらく、紹介動画かと思われます。</p>

<p><a href="http://www.teu.ac.jp/student/006532.html">学園祭（紅華祭・かまた祭）[2017年] | 学生生活 | 東京工科大学</a></p>

<h2 id="来年に向けて">来年に向けて</h2>

<p>展示品の数が少なかったので来年はもっと数を増やすべきだと思いました。来場された方が見て分かるよう説明を加えるなど「何を、どのように実現しているか」を明確にする必要があると感じました。</p>

<p>また、来場された方から「今年は冊子を作ってないんですか？」と聞かれることがあったので来年は部誌のような冊子を作成したいと思います。</p>

<p><strong>来場して頂きありがとうございました。ぜひ来年もお越しください!!</strong></p>

</div>

      </div>
  </div>
  <div class="row">  
   
  
          
           
      <div class="col-sm-12 col-sm-12 col-md-12 col-lg-12">
        <div class="pt-4" id="comment-section">
          
        </div>
      </div>
   
  </div>
  
</div>
      <footer class="footer text-white bg-info">
  <div class="container">
    <div class="row">
      <div class="offset-lg-1 col-lg-10 col-xs-12">
        <p class="text-center mb-0 pa-0">
          &copy; 2019 Copyright &copy; 2019, LinuxClub. All rights reserved.
        </p>
        
      </div>
    </div>
  </div>
</footer>

    
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<script src="https://lc-tut.github.io/assets/js/script.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-143514982-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  </body>
</html>

